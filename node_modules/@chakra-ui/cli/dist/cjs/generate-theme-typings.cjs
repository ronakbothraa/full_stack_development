'use strict';

var fs = require('node:fs');
var config = require('./config.cjs');
var createThemeTypingsInterface = require('./create-theme-typings-interface.cjs');
var resolveOutputPath = require('./resolve-output-path.cjs');

async function generateThemeTypings({
  theme,
  out,
  strictComponentTypes,
  format,
  strictTokenTypes,
  template,
  onError
}) {
  const { default: ora } = await import('ora');
  const spinner = ora("Generating Theme Typings").start();
  try {
    const start = process.hrtime.bigint();
    const typings = await createThemeTypingsInterface.createThemeTypingsInterface(theme, {
      config: config.themeKeyConfiguration,
      strictComponentTypes,
      format,
      strictTokenTypes,
      template
    });
    const outPath = await resolveOutputPath.resolveOutputPath(out);
    spinner.info();
    spinner.text = `Write file "${outPath}"...`;
    fs.writeFileSync(outPath, typings, "utf8");
    const end = process.hrtime.bigint();
    const duration = (Number(end - start) / 1e9).toFixed(2);
    spinner.succeed(`Done in ${duration}s`);
  } catch (e) {
    spinner.fail("An error occurred");
    if (e instanceof Error) {
      console.error(e.message);
    }
    spinner.stop();
    onError?.();
  } finally {
    spinner.stop();
  }
}

exports.themeInterfaceDestination = resolveOutputPath.themeInterfaceDestination;
exports.generateThemeTypings = generateThemeTypings;
